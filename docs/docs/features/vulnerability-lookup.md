---
sidebar_position: 1
---

# Vulnerability Lookup

Veracity integrates with [CIRCL's Vulnerability Lookup](https://vulnerability.circl.lu) service to provide automated CVE (Common Vulnerabilities and Exposures) monitoring for your infrastructure.

## Overview

The Vulnerability Lookup feature allows you to:

- **Monitor CVEs** - Track vulnerabilities affecting software in your environment
- **Create Watchlists** - Define vendor/product combinations to monitor
- **Receive Alerts** - Get notified when new vulnerabilities are discovered
- **View EPSS Scores** - See exploit prediction scores for prioritization
- **Track CISA KEV** - Monitor CISA's Known Exploited Vulnerabilities catalog

## How It Works

Veracity uses the [PyVulnerabilityLookup](https://github.com/CIRCL/pyvulnerabilitylookup) Python library to query CIRCL's public vulnerability database. The service aggregates data from multiple sources including:

- **NVD** - NIST National Vulnerability Database
- **CISA KEV** - Known Exploited Vulnerabilities catalog
- **EPSS** - Exploit Prediction Scoring System
- **Various vendor advisories**

## Configuration

Access Vulnerability Lookup settings at **Settings → Vulnerability Lookup**.

### Settings

| Setting | Description | Default |
|---------|-------------|---------|
| **API URL** | Vulnerability Lookup API endpoint | `https://vulnerability.circl.lu` |
| **Enabled** | Enable/disable CVE monitoring | Enabled |
| **Scan Schedule** | Cron expression for automated scans | `0 2 * * *` (daily at 2 AM) |
| **Notification Threshold** | Minimum severity level for alerts | HIGH |
| **Python Path** | Path to Python interpreter | `/opt/veracity/app/integrations_venv/bin/python` |
| **Timeout** | API request timeout in seconds | 120 |

### Environment Variables

Settings can also be configured via environment variables (takes precedence over UI settings):

```bash
VULNERABILITY_LOOKUP_URL=https://vulnerability.circl.lu
VULNERABILITY_LOOKUP_ENABLED=true
VULNERABILITY_LOOKUP_SCAN_SCHEDULE="0 2 * * *"
VULNERABILITY_LOOKUP_NOTIFICATION_THRESHOLD=high
VULNERABILITY_LOOKUP_PYTHON_PATH=/opt/veracity/app/integrations_venv/bin/python
VULNERABILITY_LOOKUP_TIMEOUT=120
```

## CVE Watchlists

Watchlists define which software you want to monitor for vulnerabilities.

### Creating a Watchlist

1. Navigate to **Security → CVE Watchlists**
2. Click **New Watchlist**
3. Enter the vendor and product names (e.g., `apache` / `http_server`)
4. Optionally specify version constraints
5. Set the watchlist as active
6. Save

### Vendor/Product Naming

Use lowercase names matching CPE (Common Platform Enumeration) format:

| Software | Vendor | Product |
|----------|--------|---------|
| Apache HTTP Server | `apache` | `http_server` |
| Nginx | `nginx` | `nginx` |
| OpenSSL | `openssl` | `openssl` |
| PostgreSQL | `postgresql` | `postgresql` |
| Redis | `redis` | `redis` |
| Linux Kernel | `linux` | `linux_kernel` |

:::tip Finding CPE Names
Search the [NVD CPE Dictionary](https://nvd.nist.gov/products/cpe/search) to find the correct vendor and product names for your software.
:::

## Vulnerability Alerts

When a scan finds vulnerabilities matching your watchlists, alerts are created automatically.

### Alert Severities

| Severity | CVSS Score | Description |
|----------|------------|-------------|
| CRITICAL | 9.0 - 10.0 | Immediate action required |
| HIGH | 7.0 - 8.9 | High priority patching |
| MEDIUM | 4.0 - 6.9 | Scheduled patching |
| LOW | 0.1 - 3.9 | Low priority |
| INFO | 0.0 | Informational only |

### Notification Threshold

The notification threshold setting determines which alerts trigger push notifications:

- **All Severities (INFO and above)** - Receive all alerts
- **LOW and above** - Skip INFO-only alerts
- **MEDIUM and above** - Only medium severity or higher
- **HIGH and above** - Only high and critical (recommended)
- **CRITICAL only** - Only the most severe vulnerabilities

## Running Scans

### Automated Scans

By default, CVE scans run daily at 2 AM (configurable via cron schedule). The scan:

1. Queries all active watchlists
2. Fetches vulnerabilities for each vendor/product pair
3. Creates alerts for new vulnerabilities
4. Updates existing alerts if data changed
5. Sends notifications based on threshold

### Manual Scans

To run a scan immediately:

1. Go to **Settings → Vulnerability Lookup**
2. Click **Run Scan Now**
3. The scan runs in the background via Sidekiq
4. Check **Scan History** for results

### Testing Connection

Before running scans, verify the API connection:

1. Go to **Settings → Vulnerability Lookup**
2. Click **Test Connection**
3. Verify you see:
   - "Connection Successful"
   - API version information
   - PyVulnerabilityLookup library version

## Python Environment

The Vulnerability Lookup feature requires Python 3.8+ with the `pyvulnerabilitylookup` package.

### Installation

The installer automatically sets up a Python virtual environment at `/opt/veracity/app/integrations_venv/` with required packages.

### Manual Setup

If needed, you can manually install the Python environment:

```bash
cd /opt/veracity/app
python3 -m venv integrations_venv
./integrations_venv/bin/pip install --upgrade pip
./integrations_venv/bin/pip install 'pyvulnerabilitylookup>=2.0.0' 'requests>=2.28.0'
chown -R deploy:deploy integrations_venv
```

### Verifying Installation

```bash
/opt/veracity/app/integrations_venv/bin/python -c "
from pyvulnerabilitylookup import PyVulnerabilityLookup
pvl = PyVulnerabilityLookup()
print('API Status:', 'UP' if pvl.is_up else 'DOWN')
print('Info:', pvl.get_info())
"
```

## Troubleshooting

### Connection Test Fails

**Symptom:** "Connection test failed" error

**Solutions:**
1. Verify Python environment exists and has correct packages:
   ```bash
   /opt/veracity/app/integrations_venv/bin/python -c "import pyvulnerabilitylookup"
   ```
2. Check outbound network connectivity to `vulnerability.circl.lu`:
   ```bash
   curl -sS https://vulnerability.circl.lu/api/version
   ```
3. Verify Python path in settings matches actual location

### No Vulnerabilities Found

**Symptom:** Scan completes but no alerts created

**Solutions:**
1. Verify watchlist vendor/product names match CPE format
2. Check watchlist is marked as "active"
3. Try a known vulnerable product (e.g., `apache` / `http_server`)
4. Check Rails logs for API errors:
   ```bash
   tail -f /opt/veracity/app/log/production.log | grep -i "cve\|vulnerability"
   ```

### Scan Timeout

**Symptom:** Scans fail with timeout errors

**Solutions:**
1. Increase timeout setting (default: 120 seconds)
2. Reduce number of active watchlists
3. Check network latency to CIRCL API

### Python Import Errors

**Symptom:** "ModuleNotFoundError: No module named 'pyvulnerabilitylookup'"

**Solutions:**
1. Reinstall the package:
   ```bash
   /opt/veracity/app/integrations_venv/bin/pip install --upgrade pyvulnerabilitylookup
   ```
2. Verify Python path setting points to correct virtual environment

## API Reference

The Vulnerability Lookup feature uses these PyVulnerabilityLookup methods:

| Method | Purpose |
|--------|---------|
| `is_up` | Check if API is available |
| `get_info()` | Get API version information |
| `get_cve(cve_id)` | Fetch details for a specific CVE |
| `get_vendor_product_vulnerabilities(vendor, product)` | Fetch vulnerabilities by vendor/product |
| `get_last(number)` | Get most recent vulnerabilities |
| `cisa.get_all()` | Get CISA Known Exploited Vulnerabilities |

For more details, see the [PyVulnerabilityLookup documentation](https://github.com/CIRCL/pyvulnerabilitylookup).

## Data Sources

CIRCL's Vulnerability Lookup aggregates data from:

- **[NVD](https://nvd.nist.gov/)** - NIST National Vulnerability Database
- **[CISA KEV](https://www.cisa.gov/known-exploited-vulnerabilities-catalog)** - Known Exploited Vulnerabilities
- **[EPSS](https://www.first.org/epss/)** - Exploit Prediction Scoring System
- **Vendor Security Advisories** - Microsoft, Red Hat, Ubuntu, etc.
