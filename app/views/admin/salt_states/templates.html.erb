<% content_for :title, "Salt Templates Library" %>

<%= render layout: 'shared/sidebar' do %>
  <div class="p-4 lg:p-6">
    <!-- Header -->
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
      <div>
        <div class="flex items-center gap-2 text-sm text-base-content/60 mb-1">
          <%= link_to "Salt Editor", admin_salt_states_path, class: "hover:text-primary" %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
          <span>Templates</span>
        </div>
        <h1 class="text-2xl font-bold text-base-content flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
          </svg>
          Templates Library
        </h1>
        <p class="text-base-content/60 mt-1">Pre-built Salt states ready to use or customize</p>
      </div>
      <div class="flex gap-2 mt-4 lg:mt-0">
        <%= link_to admin_salt_states_path, class: "btn btn-sm btn-ghost gap-2" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to States
        <% end %>
      </div>
    </div>

    <% if @templates.any? %>
      <!-- Group by Category -->
      <% @templates.group_by(&:category).sort.each do |category, templates| %>
        <div class="mb-8">
          <h2 class="text-lg font-semibold text-base-content mb-4 flex items-center gap-2">
            <span class="badge badge-lg badge-ghost"><%= category&.titleize || 'Uncategorized' %></span>
            <span class="text-sm text-base-content/40">(<%= templates.size %> templates)</span>
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
            <% templates.each do |template| %>
              <div class="card bg-base-100 shadow-sm hover:shadow-md transition-shadow border border-primary/20">
                <div class="card-body p-4">
                  <!-- Header -->
                  <div class="flex items-start justify-between gap-2">
                    <div class="flex-1 min-w-0">
                      <h3 class="font-semibold text-base-content truncate">
                        <%= template.display_name %>
                      </h3>
                      <% if template.description.present? %>
                        <p class="text-xs text-base-content/60 line-clamp-2 mt-0.5"><%= template.description %></p>
                      <% end %>
                    </div>
                    <span class="badge badge-sm <%= template.type_badge_class %>"><%= template.state_type.titleize %></span>
                  </div>

                  <!-- Code Preview -->
                  <div class="mt-3 bg-base-200 rounded p-2 max-h-24 overflow-hidden">
                    <pre class="text-xs font-mono text-base-content/70 whitespace-pre-wrap"><%= template.content.lines.first(6).join.truncate(200) %></pre>
                  </div>

                  <!-- Actions -->
                  <div class="card-actions justify-end mt-3 pt-3 border-t border-base-200">
                    <%= link_to admin_salt_state_path(template), class: "btn btn-xs btn-ghost" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                      </svg>
                      View
                    <% end %>
                    <%= button_to clone_admin_salt_state_path(template), method: :post, class: "btn btn-xs btn-primary gap-1" do %>
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                      </svg>
                      Use Template
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
<% end %>
