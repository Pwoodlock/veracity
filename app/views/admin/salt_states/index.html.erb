<% content_for :title, "Salt Editor" %>

<%= render layout: 'shared/sidebar' do %>
  <div class="p-4 lg:p-6">
    <!-- Header -->
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6">
      <div>
        <h1 class="text-2xl font-bold text-base-content flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
          Salt Editor
        </h1>
        <p class="text-base-content/60 mt-1">Manage Salt states, pillars, cloud profiles, and orchestration</p>
      </div>
      <div class="flex gap-2 mt-4 lg:mt-0">
        <%= link_to templates_admin_salt_states_path, class: "btn btn-sm btn-ghost gap-2" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
          </svg>
          Templates
        <% end %>
        <div class="dropdown dropdown-end">
          <label tabindex="0" class="btn btn-sm btn-primary gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            New
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </label>
          <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52">
            <li><%= link_to "State", new_admin_salt_state_path(type: 'state'), class: "gap-2" %></li>
            <li><%= link_to "Pillar", new_admin_salt_state_path(type: 'pillar'), class: "gap-2" %></li>
            <li><%= link_to "Orchestration", new_admin_salt_state_path(type: 'orchestration'), class: "gap-2" %></li>
            <li class="divider"></li>
            <li><%= link_to "Cloud Profile", new_admin_salt_state_path(type: 'cloud_profile'), class: "gap-2" %></li>
            <li><%= link_to "Cloud Provider", new_admin_salt_state_path(type: 'cloud_provider'), class: "gap-2" %></li>
            <li><%= link_to "Cloud Map", new_admin_salt_state_path(type: 'cloud_map'), class: "gap-2" %></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="card bg-base-100 shadow-sm mb-6">
      <div class="card-body py-4">
        <%= form_with url: admin_salt_states_path, method: :get, local: true, class: "flex flex-wrap gap-4 items-end" do |f| %>
          <!-- Type Filter -->
          <div class="form-control">
            <label class="label py-1">
              <span class="label-text text-xs">Type</span>
            </label>
            <select name="type" class="select select-bordered select-sm w-40" onchange="this.form.submit()">
              <option value="">All Types</option>
              <% @state_types.each do |type| %>
                <option value="<%= type %>" <%= 'selected' if params[:type] == type %>><%= type.titleize %></option>
              <% end %>
            </select>
          </div>

          <!-- Category Filter -->
          <div class="form-control">
            <label class="label py-1">
              <span class="label-text text-xs">Category</span>
            </label>
            <select name="category" class="select select-bordered select-sm w-40" onchange="this.form.submit()">
              <option value="">All Categories</option>
              <% @categories.each do |cat| %>
                <option value="<%= cat %>" <%= 'selected' if params[:category] == cat %>><%= cat.titleize %></option>
              <% end %>
            </select>
          </div>

          <!-- Templates Filter -->
          <div class="form-control">
            <label class="label py-1">
              <span class="label-text text-xs">Source</span>
            </label>
            <select name="templates" class="select select-bordered select-sm w-40" onchange="this.form.submit()">
              <option value="">All</option>
              <option value="true" <%= 'selected' if params[:templates] == 'true' %>>Templates Only</option>
              <option value="false" <%= 'selected' if params[:templates] == 'false' %>>User Created</option>
            </select>
          </div>

          <!-- Active Filter -->
          <div class="form-control">
            <label class="label py-1">
              <span class="label-text text-xs">Status</span>
            </label>
            <select name="active" class="select select-bordered select-sm w-40" onchange="this.form.submit()">
              <option value="">All</option>
              <option value="true" <%= 'selected' if params[:active] == 'true' %>>Deployed</option>
              <option value="false" <%= 'selected' if params[:active] == 'false' %>>Not Deployed</option>
            </select>
          </div>

          <!-- Search -->
          <div class="form-control flex-1 min-w-48">
            <label class="label py-1">
              <span class="label-text text-xs">Search</span>
            </label>
            <div class="join">
              <input type="text" name="search" value="<%= params[:search] %>" placeholder="Search by name..." class="input input-bordered input-sm join-item flex-1" />
              <button type="submit" class="btn btn-sm btn-primary join-item">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
              </button>
            </div>
          </div>

          <% if params[:type].present? || params[:category].present? || params[:templates].present? || params[:active].present? || params[:search].present? %>
            <%= link_to "Clear Filters", admin_salt_states_path, class: "btn btn-sm btn-ghost" %>
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- States Grid -->
    <% if @salt_states.any? %>
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
        <% @salt_states.each do |salt_state| %>
          <div class="card bg-base-100 shadow-sm hover:shadow-md transition-shadow">
            <div class="card-body p-4">
              <!-- Header -->
              <div class="flex items-start justify-between gap-2">
                <div class="flex-1 min-w-0">
                  <h3 class="font-semibold text-base-content truncate">
                    <%= salt_state.display_name %>
                  </h3>
                  <% if salt_state.description.present? %>
                    <p class="text-xs text-base-content/60 line-clamp-1 mt-0.5"><%= salt_state.description %></p>
                  <% end %>
                </div>
                <div class="flex-shrink-0 flex gap-1">
                  <span class="badge badge-sm <%= salt_state.type_badge_class %>"><%= salt_state.state_type.titleize %></span>
                  <% if salt_state.is_template? %>
                    <span class="badge badge-sm badge-outline">Template</span>
                  <% end %>
                </div>
              </div>

              <!-- Meta -->
              <div class="flex flex-wrap gap-2 mt-2">
                <% if salt_state.category.present? %>
                  <span class="badge badge-xs badge-ghost"><%= salt_state.category %></span>
                <% end %>
                <% if salt_state.is_active? %>
                  <span class="badge badge-xs badge-success gap-1">
                    <span class="w-1.5 h-1.5 bg-success rounded-full animate-pulse"></span>
                    Deployed
                  </span>
                <% else %>
                  <span class="badge badge-xs badge-ghost">Not deployed</span>
                <% end %>
              </div>

              <!-- Actions -->
              <div class="card-actions justify-end mt-3 pt-3 border-t border-base-200">
                <%= link_to admin_salt_state_path(salt_state), class: "btn btn-xs btn-ghost" do %>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                  View
                <% end %>
                <%= link_to edit_admin_salt_state_path(salt_state), class: "btn btn-xs btn-ghost" do %>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                  </svg>
                  Edit
                <% end %>
                <% if salt_state.is_active? %>
                  <%= button_to undeploy_admin_salt_state_path(salt_state), method: :post, class: "btn btn-xs btn-warning", data: { confirm: "Remove this state from the Salt master?" } do %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                    </svg>
                    Undeploy
                  <% end %>
                <% else %>
                  <%= button_to deploy_admin_salt_state_path(salt_state), method: :post, class: "btn btn-xs btn-success" do %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                    Deploy
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <!-- Empty State -->
      <div class="card bg-base-100 shadow-sm">
        <div class="card-body items-center text-center py-12">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-base-content/20 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
          </svg>
          <h3 class="text-lg font-semibold text-base-content/60">No Salt states found</h3>
          <p class="text-base-content/40 mt-1">
            <% if params[:type].present? || params[:category].present? || params[:search].present? %>
              Try adjusting your filters
            <% else %>
              Get started by creating a new state or importing a template
            <% end %>
          </p>
          <div class="flex gap-2 mt-4">
            <%= link_to new_admin_salt_state_path(type: 'state'), class: "btn btn-primary btn-sm" do %>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              Create State
            <% end %>
            <%= link_to templates_admin_salt_states_path, class: "btn btn-ghost btn-sm" do %>
              Browse Templates
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
